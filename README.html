<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
          <title>Place-image.lua – Pandoc Lua filter to enhance control of markdown images</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
    <script src="README_files/header-attrs-2.10/header-attrs.js"></script>
    <script src="README_files/jquery-1.11.3/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="README_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
    <script src="README_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
    <script src="README_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
    <script src="README_files/bootstrap-3.3.5/shim/respond.min.js"></script>
    <style>h1 {font-size: 34px;}
           h1.title {font-size: 38px;}
           h2 {font-size: 30px;}
           h3 {font-size: 24px;}
           h4 {font-size: 18px;}
           h5 {font-size: 16px;}
           h6 {font-size: 12px;}
           code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
           pre:not([class]) { background-color: white }</style>
    <script src="README_files/navigation-1.1/tabsets.js"></script>
    <link href="README_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
    <script src="README_files/pagedtable-1.1/js/pagedtable.js"></script>
      <link rel="stylesheet" href="css-md/mdstyles.css" />
      <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>

<body>
      <header id="title-block-header">
    <h1 class="title">Place-image.lua – Pandoc Lua filter to enhance
control of markdown images</h1>
                  </header>
      <nav id="TOC" role="doc-toc">
        <ul>
        <li><a href="#a-solution-for-enhanced-image-control"
        id="toc-a-solution-for-enhanced-image-control">A solution for
        enhanced image control</a>
        <ul>
        <li><a href="#parameters-for-a-specific-image"
        id="toc-parameters-for-a-specific-image">Parameters for a
        specific image</a>
        <ul>
        <li><a href="#examples" id="toc-examples">Examples</a></li>
        </ul></li>
        <li><a href="#global_params" id="toc-global_params">Global
        parameters applying to <em>all</em> doc images</a></li>
        </ul></li>
        <li><a href="#document-formats-supported"
        id="toc-document-formats-supported">Document formats
        supported</a></li>
        <li><a href="#commands_table" id="toc-commands_table">What this
        filter allows you to do</a>
        <ul>
        <li><a href="#parameters-you-can-use"
        id="toc-parameters-you-can-use">Parameters you can use</a></li>
        </ul></li>
        <li><a href="#invoking-filter-from-pandoc"
        id="toc-invoking-filter-from-pandoc">Invoking filter from
        Pandoc</a></li>
        <li><a href="#special-considerations-for-latexpdf-documents"
        id="toc-special-considerations-for-latexpdf-documents">Special
        considerations for latex/pdf documents</a>
        <ul>
        <li><a href="#include-these-packages"
        id="toc-include-these-packages">Include these packages</a></li>
        <li><a href="#image-wrapping-in-latexpdf-documents"
        id="toc-image-wrapping-in-latexpdf-documents">Image wrapping in
        latex/pdf documents</a>
        <ul>
        <li><a href="#repairing-defective-text-wraps"
        id="toc-repairing-defective-text-wraps">Repairing defective
        text-wraps</a></li>
        </ul></li>
        </ul></li>
        <li><a
        href="#different-parameters-for-different-document-formats"
        id="toc-different-parameters-for-different-document-formats">Different
        parameters for different document formats</a></li>
        </ul>
  </nav>
    <div id="a-solution-for-enhanced-image-control"
    class="section level1">
    <h1>A solution for enhanced image control</h1>
    <p>The <em>image-placement.lua</em> Pandoc filter is intended to
    address some commonly encountered shortcomings when displaying
    images in documents created by Pandoc from markdown documents.</p>
    <p>Till now, workarounds included using html notation and
    modifications to templates. This filter allows more elegant
    solutions by allowing use of built-in functionality of pandoc to
    read attributes entered with the image statement within brackets {
    }.</p>
    <p>This filter lets you specify display of images in two ways.</p>
    <div id="for-each-specific-image" class="section level4">
    <h4>For each specific image</h4>
    <p>Each markdown image statement can include desired parameters,
    e.g.,</p>
    <p><code>!\[My caption](my-image.jpg){width=2.5in fig_cap_label="My Figure"}</code></p>
    <p>A parameter for a specific image will override any global
    parameter.</p>
    </div>
    <div id="globally-for-all-images" class="section level4">
    <h4>Globally, for <em>all</em> images</h4>
    <p>You can affect all images within a global “<a
    href="#global_params">imageplacement</a>” statement in the YAML Meta
    section at the top of the markdown document, e.g.,</p>
    <p><code>imageplacement: width=2.5in, fig_cap_label="My Figure"</code></p>
    </div>
    <div id="parameters-for-a-specific-image" class="section level2">
    <h2>Parameters for a specific image</h2>
    <p>Parameters in <em>specific image</em> statements must
    <em>not</em> be separated by commas; doing so will cause Pandoc to
    throw up in its mouth, with unexpected results. (This contrasts with
    how global parameters must be separated <em>with</em> commas within
    the YAML Meta statement. I know, I know — but that’s out of my
    control.)</p>
    <p>The following illustrates how to easily size a specific image to
    45% of page width, float it to the right with text wrapped around
    it, and place the caption <em>below</em> (rather than above) the
    image.</p>
    <p><code>![My caption](my-image.jpg){width=45% position=float-right cap_position=below}</code></p>
    <p>These and other available parameters are <a
    href="#commands_table">listed below</a>.</p>
    <div id="examples" class="section level3">
    <h3>Examples</h3>
    <p><div id='fig_1' style='margin-right:auto; margin-left:auto; padding: 9.6px 0px 9.6px 0px ; width:100%; '><div style='width:90%; margin:auto; text-align:center; padding-bottom:9.6px'><span style='font-family:; font-style:plain; font-size:medium; '><span style='font-style:normal; font-weight:normal; '></span>Here are two examples of how a markdown image statement can specify image parameters</span></div><img src='images-md/examples.png' width='100%'/></div></p>
    </div>
    </div>
    <div id="global_params" class="section level2">
    <h2>Global parameters applying to <em>all</em> doc images</h2>
    <p>Note, global parameters must be separated <em>with</em> commas
    within the global YAML Meta imageplacement statement at the top of
    the markdown document, for example,</p>
    <p><code>imageplacement: fig_cap_label="Figure", fig_cap_label_sep=":_"</code></p>
    <p>Global parameter(s) apply to <em>all</em> images or any parameter
    not otherwise specified in a specific image statement. For example,
    you may wish to include a standard label for all images, such as “My
    Figure 1:” to precede each image caption. You can accomplish this
    with the following in your YAML header:</p>
    <pre><code>---
title: &quot;Plan for Controlling Weather&quot;
imageplacement: fig_cap_label=&quot;My Figure&quot;, fig_cap_label_sep=&quot;:_&quot; 
output:
  html_document:
    pandoc_args: [&quot;--lua-filter=place-image.lua&quot;]
    css: &quot;css-md/mdstyles.css&quot;
    template: &quot;templates/default.html5&quot;
params:
  author: Your Name
---</code></pre>
    <p>This will cause every image to be preceded by the label “My
    Figure” followed by a space and sequence number particular to the
    label. The parameter line</p>
    <p><code>fig_cap_label_sep=":_"</code></p>
    <p>will cause a colon and space to separate that from the caption,
    as in “My Figure 3: This is my caption…”</p>
    <p>You can cause the label to be bold face by adding the
    “cap_label_style” parameter, for example,</p>
    <p><code>imageplacement: fig_cap_label="My Figure", fig_cap_label_sep=":_", cap_label_style=bold</code></p>
    <p>This would produce a caption like this: “<strong>My Figure
    3:</strong> This is my caption…” </p>
    <blockquote>
    <p>Note 1 — unlike with parameters listed with images, image
    parameters in the YAML header must be separated by commas, due to
    the way the Lua language scans the YAML header for parameters;
    failing to include commas may cause Pandoc to pee on itself, causing
    a “scan” error and high blood pressure.</p>
    </blockquote>
    <blockquote>
    <p>Note 2 — Note the “fig_cap_label_sep” parameter of “:_”. The
    underscore character following the colon indicates a space “ ”
    character. This is because an actual space character in a YAML
    parameter string also can cause a “scan” error. Therefore, use the
    “_” underscore character to indicate a space.</p>
    </blockquote>
    </div>
    </div>
    <div id="document-formats-supported" class="section level1">
    <h1>Document formats supported</h1>
    <p>Currently this filter supports Pandoc converson of markdown
    documents to</p>
    <ul>
    <li>html</li>
    <li>docx</li>
    <li>pdf — The ‘<a
    href="https://www.ctan.org/pkg/wrapfig?lang=en">wrapfig</a>’ package
    is required for text-wrap. See <a href="#using-wrapfig">Using
    wrapfig</a>, below.</li>
    <li>latex — The ‘<a
    href="https://www.ctan.org/pkg/wrapfig?lang=en">wrapfig</a>’ package
    is required for text-wrap. See <a href="#using-wrapfig">Using
    wrapfig</a>, below.</li>
    <li>epub</li>
    </ul>
    </div>
    <div id="commands_table" class="section level1">
    <h1>What this filter allows you to do</h1>
    <p>Below is a table of parameters you can include in your markdown
    image specifier. Wherever a size dimension is required, you can use
    any of the following dimensions. (Ensure there are no spaces between
    the number and dimension, e.g., “350px”. “350 px” may produce
    unexpected results.</p>
    <ul>
    <li>% — percentage of parent width</li>
    <li>in — inches</li>
    <li>cm — centimeters</li>
    <li>mm — milimeters</li>
    <li>px — pixels (at 72 per-inch)</li>
    </ul>
    <p>You may enter parameters in any order, for example:</p>
    <p><code>![My caption](my-image.jpg){position=float-left cap_position=below width=50%}</code>
     </p>
    <div id="parameters-you-can-use" class="section level2">
    <h2>Parameters you can use</h2>
    <table>
    <colgroup>
    <col width="18%" />
    <col width="31%" />
    <col width="18%" />
    <col width="9%" />
    <col width="22%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th align="left">Parameter</th>
    <th align="left">Notes</th>
    <th align="left">Options</th>
    <th align="left">Default </th>
    <th align="left">Examples</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td align="left">width</td>
    <td align="left">Image width</td>
    <td align="left">*</td>
    <td align="left">50%</td>
    <td align="left">width=35%, width=200px, width=3cm, width=2.5in</td>
    </tr>
    <tr class="even">
    <td align="left">position</td>
    <td align="left">Horizontal position relative to page.</td>
    <td align="left">left, center, right, float-left, float-right</td>
    <td align="left">center</td>
    <td align="left">position=center, position=float-right</td>
    </tr>
    <tr class="odd">
    <td align="left">h_padding</td>
    <td align="left">Horizontal separation between image and surrounding
    text</td>
    <td align="left">*</td>
    <td align="left">0.15in</td>
    <td align="left">h_padding=0.15in, h_padding=4mm, h_padding=10px,
    etc.</td>
    </tr>
    <tr class="even">
    <td align="left">v_padding</td>
    <td align="left">Vertical separation between image and surrounding
    text</td>
    <td align="left">*</td>
    <td align="left">0.1in</td>
    <td align="left">v_padding=0.12in, v_padding=.3cm, v_padding=9px,
    etc.</td>
    </tr>
    <tr class="odd">
    <td align="left">cap_width</td>
    <td align="left">Width of caption. If percent, relative to image
    width</td>
    <td align="left">*</td>
    <td align="left">90%</td>
    <td align="left">cap_width=100%, cap_width=250px, cap_width=1in,
    etc.</td>
    </tr>
    <tr class="even">
    <td align="left">cap_position</td>
    <td align="left">Caption vertical position relative to image</td>
    <td align="left">above, below</td>
    <td align="left">above</td>
    <td align="left">cap_position=below</td>
    </tr>
    <tr class="odd">
    <td align="left">cap_h_position</td>
    <td align="left">Caption horizontal alignment relative to image
    (caption itself may only be above or below)</td>
    <td align="left">left, center, right</td>
    <td align="left">center</td>
    <td align="left">Options: left, center, right
    cap_h_position=left</td>
    </tr>
    <tr class="even">
    <td align="left">cap_text_align</td>
    <td align="left">Caption text alignment</td>
    <td align="left">left, center, right</td>
    <td align="left">center</td>
    <td align="left">cap_text_align=left</td>
    </tr>
    <tr class="odd">
    <td align="left">cap_text_size</td>
    <td align="left">Allows tweak of caption text size relative to body
    text</td>
    <td align="left">small, normal, large</td>
    <td align="left">normal</td>
    <td align="left">cap_text_size=normal</td>
    </tr>
    <tr class="even">
    <td align="left">cap_text_font</td>
    <td align="left">If specified, font must be a registered system
    font; use sparingly</td>
    <td align="left">Options may include any system font.</td>
    <td align="left">body text</td>
    <td align="left">cap_text_font=Helvetica, cap_text_font=Arial,
    cap_text_font=Times, etc.</td>
    </tr>
    <tr class="odd">
    <td align="left">cap_text_style</td>
    <td align="left">Caption text style</td>
    <td align="left">plain, italic, bold, oblique, bold-oblique</td>
    <td align="left">plain</td>
    <td align="left"></td>
    </tr>
    <tr class="even">
    <td align="left">fig_cap_label</td>
    <td align="left">Allows specifying a numbered custom label that
    appears before caption</td>
    <td align="left">Options may include any string. Note, if your label
    is more than one word, you must enclose it within quotes, e.g., "My
    Photo".</td>
    <td align="left">none</td>
    <td align="left">For example, "fig_cap_label=Figure" will result in
    a label like “Figure 4”.<br/> fig_cap_label="My Photo" will produce
    a lable like “My Photo 1”, etc.</td>
    </tr>
    <tr class="odd">
    <td align="left">fig_cap_label_sep  </td>
    <td align="left">Allows specifying a custom separator character(s)
    between the numbered custom label and caption. Note: If your label
    is more than one word, you must enclose it within quotes, e.g., "My
    Photo"; otherwise, only the first word (“My”) will be included.</td>
    <td align="left">  </td>
    <td align="left"></td>
    <td align="left">By default, label and caption are separated by a
    colon followed by a space character, like this: <br/>“Figure 4: My
    caption…”<br/>Ensure you enclose your custom separater within quotes
    if it will contain any space character and use the underscore
    character to indicate the space. For example, the following shows a
    custom separator, a hyphen surrounded by space characters:
    <br/>‘fig_cap_label_sep="_-_"’ <br/>It will appear as, for
    example,<br/>“Photo 2 - My caption…”</td>
    </tr>
    <tr class="even">
    <td align="left">pdf_adjust_lines</td>
    <td align="left">This allows tweaking the wrap height for a wrapped
    image in latex/pdf formats. Sometimes the wrapfig extension
    misjudges wrap height and text may flow into the image below or have
    too much empty space below. Should this occur, you may try
    specifying different equialent line heights for that image, e.g.,
    “10”, “15”, etc. (You also may wish to tweak the image width in such
    cases, e.g., “width=42%” instead of “…45%.”)</td>
    <td align="left">This parameter affects <em>only</em> latex/pdf
    images.</td>
    <td align="left"></td>
    <td align="left">pdf_adjust_lines=10, pdf_adjust_lines=12,
    pdf_adjust_lines=15, etc.</td>
    </tr>
    </tbody>
    </table>
    <ul>
    <li>A number followed immediately by one of “in”, “cm”, “mm” or
    “px”</li>
    </ul>
    </div>
    </div>
    <div id="invoking-filter-from-pandoc" class="section level1">
    <h1>Invoking filter from Pandoc</h1>
    <p>This filter can be invoked on the command line with the
    “–lua-filter” option, e.g., “--lua-filter=place-image.lua”. An
    example might be</p>
    <p><code>pandoc -f markdown -t html test.md -o test.html --css=./css-md/mdstyles.css --template=templates/default.html5 --lua-filter=./place-image.lua -s</code></p>
    <p>Alternatively, if you are working within an environment like
    R-Studio that runs Pandoc, it may be included in the YAML header,
    for example,</p>
    <pre><code>---
title: \&quot;My extraordinarily beautiful document\&quot; 
output:
  html_document:
    pandoc_args: [\&quot;--lua-filter=place-image.lua\&quot;]
---</code></pre>
    </div>
    <div id="special-considerations-for-latexpdf-documents"
    class="section level1">
    <h1>Special considerations for latex/pdf documents</h1>
    <div id="include-these-packages" class="section level2">
    <h2>Include these packages</h2>
    <p>For Pandoc conversion into Latex and pdf, these three package
    statements should be included in the latex template file. (They
    already are in the “default.latex” and “eisvogel.latex” templates in
    the “templates” folder on this site.)</p>
    <p><code>\usepackage{layouts} % allows calculating width relative to latex/pdf page width \usepackage{wrapfig} % enables text wrap-around of figures \usepackage[export]{adjustbox}  % must include to enable additional positioning</code></p>
    <p>Again, these package statements already are in following two
    template versions included on this site, either of which you can use
    for Pandoc conversion into latex/pdf documents:</p>
    <ul>
    <li>default.latex — The default latex template by Pandoc author John
    MacFarlane, to which I added those statements.</li>
    <li>eisvogel.latex - The latex template by Pascal Wagler, based upon
    template by Pandoc author John MacFarlane. This is the latex
    template I prefer for its expanded capabilities.</li>
    </ul>
    </div>
    <div id="image-wrapping-in-latexpdf-documents"
    class="section level2">
    <h2>Image wrapping in latex/pdf documents</h2>
    <p>Image wrapping for floating images in these formats is handled by
    Donald Arseneau’s neat ‘wrapfig’ package{#using-wrapfig}.</p>
    <div id="repairing-defective-text-wraps" class="section level3">
    <h3>Repairing defective text-wraps</h3>
    <p>There is a known issue with respect to wrapfig’s text-wrap
    accuracy. After you’ve generated a latex or pdf document, it’s
    common to find some floated images extending into wrapped text
    below, or with extra blank space below the image. This is because
    wrapfig <em>guesses</em> the equivalent number of blank lines needed
    to match the height of the image — and sometimes it guesses wrong.
    Should this problem occur, you may enter a ‘pdf_adjust_lines’
    parameter to try different equialent line heights for that image,
    e.g., “10”, “15”, etc., until you are satisfied. Here are a few
    examples of using the ‘pdf_adjust_lines’ parameter:</p>
    <p><code>pdf_adjust_lines=10 pdf_adjust_lines=12 pdf_adjust_lines=15, etc.</code></p>
    </div>
    </div>
    </div>
    <div id="different-parameters-for-different-document-formats"
    class="section level1">
    <h1>Different parameters for different document formats</h1>
    <p>This filter allows you to specify different image parameters,
    depending upon document format. For example, you may wish images in
    your Word .docx files to be slightly smaller than those in your
    .html documents. You can preface any parameter with its format
    identifier and that parameter will override any default or other
    image parameter.</p>
    <p>For example, the following will cause the image width to appear
    at 50% of page width for any supported format except .docx images,
    which will be sized to 45%:</p>
    <p><code>![My caption](my-image.jpg){position=float-right width=50% docx:width=45%}]</code></p>
    <p>Supported document format identifiers include the following:</p>
    <ul>
    <li>html:</li>
    <li>docx:</li>
    <li>pdf:</li>
    <li>latex:</li>
    <li>epub:</li>
    </ul>
    <p>I hope you find some of this useful. I welcome any corrections,
    feedback and suggestions!</p>
    </div>
  </body>

</html>
